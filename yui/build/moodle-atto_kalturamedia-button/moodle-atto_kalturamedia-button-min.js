YUI.add("moodle-atto_kalturamedia-button",function(e,t){var n={URLINPUT:"atto_kalturamedia_urlentry",NAMEINPUT:"atto_kalturamedia_nameentry"};({URLINPUT:"."+n.URLINPUT,NAMEINPUT:"."+n.NAMEINPUT});e.namespace("M.atto_kalturamedia").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{_currentSelection:null,embedWindow:null,initializer:function(){this.addButton({iconurl:M.cfg.wwwroot+"/lib/editor/atto/plugins/kalturamedia/pix/icon.png",callback:this._kalturamedia})},_kalturamedia:function(){if(this._currentSelection=this.get("host").getSelection(),this._currentSelection!==!1){var e=1200,t=700,i=void 0!=window.screenLeft?window.screenLeft:screen.left,n=void 0!=window.screenTop?window.screenTop:screen.top,o=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,r=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,a=o/2-e/2+i,d=r/2-t/2+n,l=window.open(this._getIframeURL(),"Browse and Embed","scrollbars=no, width="+e+", height="+t+", top="+d+", left="+a);l.buttonJs=this,window.focus&&l.focus(),this.embedWindow=l}},_getIframeURL:function(){var t=e.mix({elementid:this.get("host").get("elementid"),contextid:this.get("contextid"),height:"600px",width:"1112px"},this.get("area"));return M.cfg.wwwroot+"/lib/editor/atto/plugins/kalturamedia/ltibrowse_container.php?"+e.QueryString.stringify(t)},_getCourseId:function(){var e,t=document.getElementsByTagName("body")[0].className,n=t.split(" ");for(i in n)if(n[i].indexOf("course-")>-1){var o=n[i].split("-");e=o[1]}return e},_replaceKafUriWithToken:function(e,t,i){return e=this._removeProtocolFromUrl(e),t=this._removeProtocolFromUrl(t),e.replace(t,i)},_removeProtocolFromUrl:function(e){return e.replace(/^https?:\/\//,"")},embedItem:function(e,t){embedInfo={};for(param in t){var i=param.split("-");"embedinfo"==i[0]&&(embedInfo[i[1]]=t[param])}var n=this.get("kalturauritoken"),o=this.get("kafuri"),r=embedInfo.url,a=this._replaceKafUriWithToken(r,o,n),d=document.createElement("a");d.href=r,a+=d.search;var l='<a href="http://'+a+'">tinymce-kalturamedia-embed||'+embedInfo.title+"||"+embedInfo.width+"||"+embedInfo.height+"</a>";host=this.get("host"),host.setSelection(this._currentSelection),host.insertContentAtFocusPoint(l),this.markUpdated(),this.embedWindow.close()}},{ATTRS:{contextid:{value:null},kalturauritoken:{value:null},kafuri:{value:null}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});